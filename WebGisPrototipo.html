<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>WebGIS - Busca AvanÃ§ada</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  font-family: "Segoe UI", Roboto, Arial, sans-serif;
}

#container {
  display: flex;
  height: 100%;
}

/* SIDEBAR */
#sidebar {
  width: 300px;
  padding: 22px;
  color: white;
  background: linear-gradient(45deg,#0ba1cb,#09e014,#540798,#b91111);
  background-size: 400% 400%;
  animation: gradientMove 6s ease infinite;
}

@keyframes gradientMove {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

#sidebar h3 { margin-bottom: 20px; }

#sidebar select, #sidebar button {
  width: 100%;
  padding: 12px;
  margin-bottom: 15px;
  border-radius: 10px;
  border: none;
}

#sidebar button {
  background: rgba(255,255,255,0.25);
  color: white;
  font-weight: bold;
  cursor: pointer;
}

#map { flex: 1; }
</style>
</head>

<body>

<div id="container">
  <div id="sidebar">
    <h3>ğŸ“ Buscar locais</h3>
    <select id="tipo">
      <option value="restaurant">ğŸ½ Restaurantes</option>
      <option value="gym">ğŸ‹ï¸ Academias</option>
      <option value="pharmacy">ğŸ’Š FarmÃ¡cias</option>
      <option value="hospital">ğŸ¥ Hospitais</option>
      <option value="store">ğŸ¬ Lojas</option>
      <option value="bus_station">ğŸšŒ Pontos de Ã´nibus</option>
    </select>
    <button onclick="buscar()">Buscar</button>
  </div>
  <div id="map"></div>
</div>

<script>
let map, service;
let markers = [];
let circle = null;

/* CONFIGURAÃ‡ÃƒO ESPECÃFICA POR CATEGORIA */
const CONFIG = {
  restaurant: {
    primary: { type: "restaurant" },
    fallback: { keyword: "restaurante lanchonete" }
  },
  gym: {
    primary: { type: "gym" },
    fallback: { keyword: "academia crossfit musculaÃ§Ã£o" }
  },
  pharmacy: {
    primary: { type: "pharmacy" },
    fallback: { keyword: "farmÃ¡cia drogaria" }
  },
  hospital: {
    primary: { type: "hospital" },
    fallback: { keyword: "hospital pronto atendimento clÃ­nica" }
  },
  store: {
    primary: { type: "store" },
    fallback: { keyword: "loja papelaria comÃ©rcio" }
  },
  bus_station: {
    primary: { type: "bus_station" },
    fallback: { keyword: "ponto de Ã´nibus" }
  }
};

function initMap() {
  const centro = { lat: -19.922731, lng: -43.992302 };

  map = new google.maps.Map(document.getElementById("map"), {
    center: centro,
    zoom: 16
  });

  service = new google.maps.places.PlacesService(map);
}

function limpar() {
  markers.forEach(m => m.setMap(null));
  markers = [];
  if (circle) circle.setMap(null);
}

function addMarker(place) {
  if (markers.some(m => m.place_id === place.place_id)) return;

  const marker = new google.maps.Marker({
    map,
    position: place.geometry.location,
    title: place.name
  });

  marker.place_id = place.place_id;
  markers.push(marker);
}

function buscar() {
  limpar();

  const tipo = document.getElementById("tipo").value;
  const conf = CONFIG[tipo];
  const centro = map.getCenter();

  circle = new google.maps.Circle({
    map,
    center: centro,
    radius: 800,
    fillOpacity: 0.1,
    strokeOpacity: 0.6
  });

  //  BUSCA PRINCIPAL 
  service.nearbySearch({
    location: centro,
    rankBy: google.maps.places.RankBy.DISTANCE,
    type: conf.primary.type
  }, (results, status) => {
    if (status === google.maps.places.PlacesServiceStatus.OK) {
      results.forEach(addMarker);
    }
  });

  //  FALLBACK 
  service.nearbySearch({
    location: centro,
    rankBy: google.maps.places.RankBy.DISTANCE,
    keyword: conf.fallback.keyword
  }, (results, status) => {
    if (status === google.maps.places.PlacesServiceStatus.OK) {
      results.forEach(addMarker);
    }
  });
}
</script>

<script async
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCDhOfl-4jQOTDMwsTbDzWGcxfBayJQyIM&libraries=places&callback=initMap">
</script>

</body>
</html>